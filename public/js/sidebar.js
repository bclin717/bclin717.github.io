$(document).ready(function(){var t=CONFIG.sidebar&&CONFIG.sidebar.tocMaxDepth||4,n="h1,h2,h3,h4,h5,h6,".slice(0,3*t).slice(0,-1);var r=null,d=null,c=!1;function e(){var t=$(".post-body, .custompage"),e=$(".sidebar-toc li"),o=t.find(n),s=o.first();if(o.each(function(){this.getBoundingClientRect().top<=5&&(r=window.encodeURIComponent(this.getAttribute("id")))}),t[0]&&s[0]&&0<s[0].getBoundingClientRect().top&&0<s.offset().top-$(window).scrollTop())c||(e.removeClass("active current"),c=!0);else if(r!==d){var i=$('.sidebar-toc a[href="#'+r+'"]');if(!i.length){var a=window.decodeURIComponent(r);i=$('.sidebar-toc a[href="#'+a+'"]')}e.removeClass("active current"),i.parents("li").addClass("active"),i.parent().addClass("current"),d=r,c=!1}}var i=!1;function o(){var t=$(".sidebar-toc").height();if(!($(".sidebar-toc > div").height()<=t)){var e=$(".sidebar-toc"),o=$(".sidebar-toc .current a");if(o[0]&&e[0]){var s=o.offset().top-e.offset().top;i=t<s||s<0}i&&o.velocity("stop").velocity("scroll",{container:e,offset:-t/2,duration:500,easing:"easeOutQuart"})}}var s=0;function a(){var t=$("#sidebar");document.getElementById("content-wrap").getBoundingClientRect().top<s?t.addClass("sidebar--sticky"):t.removeClass("sidebar--sticky")}function l(){if(0!==$("#is-post").length){var t=$(".content"),e=t.offset().top,o=0,s=!1,i=0;CONFIG.postWidget&&CONFIG.postWidget.endText&&(s=!0),o=s?$(".post-ending").offset().top-e+$(".post-ending").outerHeight():$(".post-footer").offset().top-e;var a=$(window).height(),n=0;0!==t.length&&(n=parseInt(-1*t[0].getBoundingClientRect().top)+a);var r=Number($(".sidebar-reading-info__num").text());o=parseInt(Math.abs(o)),0===(i=100<(i=parseInt(n/o*100))?100:i<0?0:i)&&0===r||100===i&&100===r||($(".sidebar-reading-info__num").text(i),$(".sidebar-reading-line").css("transform","translateX("+(i-100)+"%)"))}}CONFIG.sidebar&&CONFIG.sidebar.offsetTop&&(s=parseInt(CONFIG.sidebar.offsetTop)),e(),a(),o(),l(),$(window).on("scroll",function(){a()}),$(window).on("scroll",Stun.utils.throttle(function(){e(),o(),l()},150)),Stun.utils.pjaxReloadSidebar=function(){var e=$(".sidebar-nav-toc"),o=$(".sidebar-nav-ov"),s=$(".sidebar-toc"),i=$(".sidebar-ov");e.on("click",function(t){t.stopPropagation(),$(this).hasClass("current")||(e.addClass("current"),o.removeClass("current"),s.css("display","block"),s.velocity("stop").velocity("fadeIn"),i.css("display","none"),i.velocity("stop").velocity("fadeOut"))}),o.on("click",function(t){t.stopPropagation(),$(this).hasClass("current")||(o.addClass("current"),e.removeClass("current"),s.css("display","none"),s.velocity("stop").velocity("fadeOut"),i.css("display","block"),i.velocity("stop").velocity("fadeIn"))}),$(".post-body, .custompage").find(n)[0]||($(".sidebar-nav").addClass("hide"),$(".sidebar-toc").addClass("hide"),$(".sidebar-ov").removeClass("hide"))},Stun.utils.pjaxReloadSidebar()});